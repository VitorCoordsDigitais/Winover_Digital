<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Dashboards - Winover Digital</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="theme-switcher">
        <svg id="theme-toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></svg>
    </div>

    <header class="header">
        <!-- Container para a animação em CSS -->
        <div class="bg-animation">
            <div id="stars"></div>
            <div id="stars2"></div>
            <div id="stars3"></div>
        </div>
        <div class="header-content">
            <h1>Winover Digital</h1>
            <p>Portal de Business Intelligence</p>
        </div>
    </header>

    <main class="container">
        <div class="summary-container">
            <h2>Total Dashboards</h2>
            <div id="bi-counter" class="counter">0</div>
        </div>

        <div class="controls-container">
            <div class="tabs">
                <button class="tab-link active" onclick="openTab(event, 'Todos')">Todos</button>
                <button class="tab-link" onclick="openTab(event, 'WhatsApp')">WhatsApp</button>
                <button class="tab-link" onclick="openTab(event, 'Portal')">Portal</button>
                <button class="tab-link" onclick="openTab(event, 'AgenteVirtual')">Agente Virtual</button>
            </div>
        </div>

        <div id="Todos" class="tab-content active">
            <div class="dashboard-grid">
                <p class="loading-message">Carregando dashboards...</p>
            </div>
        </div>
        <div id="WhatsApp" class="tab-content" data-category="WhatsApp"><div class="dashboard-grid"></div></div>
        <div id="Portal" class="tab-content" data-category="Portal"><div class="dashboard-grid"></div></div>
        <div id="AgenteVirtual" class="tab-content" data-category="AgenteVirtual"><div class="dashboard-grid"></div></div>
    </main>

    <footer class="footer">
        <p>&copy; 2026 Winover Digital. Todos os direitos reservados.</p>
    </footer>

    <!-- Script ÚNICO e Principal da Página -->
    <script>
        // URL da sua nova API do Google Apps Script
        // URL da sua API do Google Apps Script
const API_URL = 'https://script.google.com/macros/s/AKfycbwNorQVMUl20ghMUWSlRnkIT15RenungAPBAOGsVb175Nu9s5waKBBJyz0znDM21S4kDA/exec';

// --- Bloco ÚNICO que executa quando o HTML está pronto ---
document.addEventListener('DOMContentLoaded', function( ) {
    
    // --- Lógica JSONP para buscar os dados ---
    // 1. Define uma função global que a API do Google vai chamar
    window.processSheetData = function(data) {
        populateDashboards(data);
        openTab(null, 'Todos');
    };

    // 2. Cria uma tag <script> dinamicamente para chamar a API
    const script = document.createElement('script');
    // 3. Adiciona o nome da nossa função na URL (o "padding")
    script.src = API_URL + '?callback=processSheetData';
    
    // 4. Adiciona o script à página, o que dispara a chamada de rede
    document.body.appendChild(script);

    // 5. Tratamento de erro se a chamada falhar (ex: timeout)
    script.onerror = function() {
        console.error('Erro fatal ao carregar o script da API do Google.');
        const todosGrid = document.querySelector('#Todos .dashboard-grid');
        if (todosGrid) {
            todosGrid.innerHTML = '<p class="loading-message">Erro de rede ao carregar dashboards.</p>';
        }
    };
    
    // Lógica do Modo Escuro (continua a mesma)
    const themeSwitcher = document.querySelector('.theme-switcher');
    const sunIconSVG = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v2"></path><path d="M12 21v2"></path><path d="M4.22 4.22l1.42 1.42"></path><path d="M18.36 18.36l1.42 1.42"></path><path d="M1 12h2"></path><path d="M21 12h2"></path><path d="M4.22 19.78l1.42-1.42"></path><path d="M18.36 5.64l1.42-1.42"></path><circle cx="12" cy="12" r="5"></circle></svg>';
    const moonIconSVG = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>';

    function setTheme(theme) {
        if (theme === 'dark') {
            document.body.classList.add('dark-mode');
            themeSwitcher.innerHTML = sunIconSVG;
        } else {
            document.body.classList.remove('dark-mode');
            themeSwitcher.innerHTML = moonIconSVG;
        }
        localStorage.setItem('theme', theme);
    }

    const currentTheme = localStorage.getItem('theme') || 'light';
    setTheme(currentTheme);

    themeSwitcher.addEventListener('click', function() {
        const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
        setTheme(newTheme);
    });
});

// --- Funções Auxiliares (fora do DOMContentLoaded) ---

function createDashboardCard(item) {
    return `
        <div class="dashboard-card">
            <div class="card-content">
                <h3>${item.Nome}</h3>
                <p>${item.Descricao}</p>
            </div>
            <div class="card-action">
                <a href="${item.Link}" target="_blank">Acessar BI</a>
            </div>
        </div>
    `;
}

function populateDashboards(data) {
    document.querySelectorAll('.dashboard-grid').forEach(grid => grid.innerHTML = '');

    if (!data || data.length === 0) {
        const todosGrid = document.querySelector('#Todos .dashboard-grid');
        if (todosGrid) {
            todosGrid.innerHTML = '<p class="loading-message">Nenhum dashboard encontrado na planilha.</p>';
        }
        animateCounter(0);
        return;
    }

    data.forEach((item, index) => {
        const cardHTML = createDashboardCard(item);
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = cardHTML;
        const cardElement = tempDiv.firstChild;
        
        if (cardElement) {
            cardElement.style.animationDelay = `${index * 0.05}s`;

            const todosGrid = document.querySelector('#Todos .dashboard-grid');
            if (todosGrid) {
                todosGrid.appendChild(cardElement.cloneNode(true));
            }
            
            if (item.Categoria) {
                const categoryId = item.Categoria.trim().replace(/\s+/g, '');
                const categoryGrid = document.querySelector(`#${categoryId} .dashboard-grid`);
                if (categoryGrid) {
                    categoryGrid.appendChild(cardElement.cloneNode(true));
                }
            }
        }
    });
    animateCounter(data.length);
}

function animateCounter(target) {
    const counterElement = document.getElementById('bi-counter');
    let current = 0;
    const duration = 1000;
    let start = null;
    function step(timestamp) {
        if (!start) start = timestamp;
        const progress = Math.min((timestamp - start) / duration, 1);
        counterElement.innerText = Math.floor(progress * target);
        if (progress < 1) { window.requestAnimationFrame(step); }
        else { counterElement.innerText = target; }
    }
    window.requestAnimationFrame(step);
}

function openTab(evt, tabName) {
    const tabcontent = document.getElementsByClassName("tab-content");
    for (let i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
    const tablinks = document.getElementsByClassName("tab-link");
    for (let i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
    document.getElementById(tabName).style.display = "block";
    if (evt) {
        evt.currentTarget.className += " active";
    } else {
        document.querySelector('.tab-link[onclick*="\'Todos\'"]').className += " active";
    }
}

    </script>

</body>
</html>

